<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta content="text/html" charset="UTF-8">
    <title>Статистика по вакансии</title>
    <!--  <link rel="icon"  th:src="@{/images/ourbor.png}" />-->
    <style>
        html, body {
            height: 100%;
            margin: 0;
        }


        body {
            background-color:#FFFFFF;
            margin: 0;
            margin-bottom: 100px;
            color: #000;
            font-size: 16px;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;

        }
        main {
            flex: 1;
        }
        footer {
            position: relative;
            left: 0;
            bottom: 0;
            width: 100%;
            background: #007991; /* Цвет фона футера */
            color: white; /* Цвет текста футера */
            text-align: center; /* Выравнивание текста по центру */
            padding: 10px 0; /* Отступы сверху и снизу */
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1); /* Тень над футером */
        }
        header {
            background: linear-gradient(to right, #007991, #78ffd6); /* Градиентный фон */
            color: white; /* Белый цвет текста */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Тень под заголовком */
            padding: 20px 0; /* Отступы сверху и снизу */
        }

        header h1 {
            font-size: 20px;
            margin: 0;
        }

        header nav {
            display: flex;
            justify-content: left;
            align-items: center;
        }

        header nav ul {
            list-style-type: none;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        header nav ul li {
            margin: 0 10px;
        }

        header h1, header h3 {
            font-size: 20px; /* Увеличенный размер шрифта */
            font-weight: bold; /* Жирный шрифт */
            margin: 0;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2); /* Тень текста */
        }

        header nav ul li a {
            color: #fff; /* Белый цвет ссылок */
            text-decoration: none;
            padding: 5px 10px; /* Отступы вокруг ссылок */
            transition: color 0.3s; /* Плавное изменение цвета при наведении */
        }
        header nav ul li a:hover {
            color: #000; /* Черный цвет текста при наведении */
        }

        main {
            padding: 10px;
        }

        h3 {
            text-align: center;
            font-size: 20px;
            margin-top:20px;
            margin-bottom: 20px;
        }


        #id2 {
            width: 25%;
            border-collapse: collapse;
            float: left;
            margin:10px;
            margin-right: 60px;
        }

        table th,
        table td {
            border: 1px solid #333;
            padding: 3px;
            border-color: inherit;
            border-style:solid;
        }

        table th {
            text-align: center;
        }

        table td {
            text-align: left;
            vertical-align: inherit;
        }

        a{
            color:black;
        }

        /* Media queries */

        @media (max-width: 768px) {
            header nav ul {
                flex-direction: row;
            }

            header nav ul li {
                margin-bottom: 5px;
            }
        }
        svg {
            width: 30px;
            margin: 0 auto;
            display: block;
        }

        /* Стили для карточек */
        .card {
            background: #fff;
            margin-bottom: 2rem;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            width: 600px;
        }

        .card-header {
            width: 600px;
            font-weight: bold;
            margin-bottom: 1.5rem;
            font-size: 1.2rem;
        }

        .card-content {
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }
        .card-content p {
            padding-top:8px;
            padding:5px;
            text-indent: 20px; /* Отступ первой строки в абзаце */
            text-align: justify;
            margin-top: 20px;
            margin-bottom: 20px; /* Отступ снизу после абзаца */

        }


        .long-text {
            column-count: 3;
            column-gap: 40px;
        }

        .card-link {
            color: #007991;
            text-decoration: none;
        }

        .form-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
        }

        form {
            width: 30%; /* Ширина каждой формы */
            background-color: #f8f8f8;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        form h3, h4 {
            text-align: center;
            margin: 0 0 10px 0;
            color: #007991;
        }

        input[type="text"], textarea, select {
            width: calc(100% - 24px);
            padding: 10px;
            margin-top: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 14px;
            background-color: #fcfcfc;
            transition: all 0.3s;
        }

        input[type="text"]:focus, textarea:focus, select:focus {
            border-color: #007991;
            outline: none;
        }

        button[type="button"] {
            width: 100%;
            margin: 5px;
            padding: 10px;
            background-color: #007991;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        button[type="button"]:hover {
            background-color: #005f6b;
        }

        .message-box {
            display: none;
            color: red;
            margin-top: 10px;
        }

    </style>
</head>
<body>
<header>
    <nav>
        <ul>
            <li><h3><a href="http://localhost:8081/api/v1/ouroboros">OuroborosOdyssey</a></h3></li>
            <li><a href="http://localhost:8081/api/v1/statistics">Требования на вакансии</a></li>
            <li><a href="http://localhost:8081/api/v1/plans">Посмотреть план изучения</a></li>
            <li><a href="http://localhost:8081/api/v1/tasks">Планировщик</a></li>
            <li><a href="http://localhost:8081/api/v1/questions">Вопросы</a></li>
            <li><a href="http://localhost:8081/api/v1/auth">Личный кабинет</a></li>

        </ul>
    </nav>
</header>

<main>
    <h4>Панель администратора</h4>

    <div class="form-container">
        <form id="createForm">
            <h3>Добавить тему</h3>

            <input type="text" id="title" placeholder="Заголовок темы" />
            <textarea id="answer" placeholder="Описание и рекомендации"></textarea>
            <input type="text" id="links" placeholder="Ссылки" />
            <button type="button" onclick="createQuestion()">Добавить</button>
            <div class="message-box" id="createMessage"></div>
        </form>


        <form id="updateForm" style="display;">
            <h3>Обновить </h3>
            <input type="hidden" id="updateId" />
            <input type="text" id="updateTitle" placeholder="Заголовок темы" />
            <textarea id="updateAnswer" placeholder="Описание и рекомендации"></textarea>
            <select class="themeSelect">
                <option value="">-- Выберите тему --</option>
            </select>
            <input type="text" id="updateLinks" placeholder="Ссылки" />
            <button type="button" onclick="updateTheme()">Обновить</button>
            <div class="message-box" id="updateMessage"></div>
        </form>


    </div>


    <div class="main-content">
        <h3>План изучения</h3>
        <div id="plan-container">
            <div th:if="${plans != null}">
                <div class="card">
                    <div class="card-header">План изучения для разработчика: <span th:text="${plans.developer}"></span>
                    </div>
                    <div class="card-content">
                        <p>Темы:</p>
                        <ul>
                            <li th:each="theme : ${plans.theme}">
                                <div class="card">
                                    <div class="card-header">
                                        <span th:text="${theme.title}"></span></n>
                                        <button type="button" onclick="editTheme(${theme.id})">Изменить</button>
                                        <button type="button" onclick="deleteTheme(${theme.id})">Удалить</button>
                                    </div>
                                    <div class="card-content">
                                        <p>Описание:</p>
                                        <p th:utext="${theme.details}"></p>
                                        <p>Ссылки: <a th:href="${theme.links}" class="card-link"
                                                      target="_blank">Перейти</a></p>
                                        <p>Вопросы:</p>
                                        <ul>
                                            <li th:each="question : ${theme.questionsList}"
                                                th:text="${question.titleQuestions}"></li>

                                        </ul>

                                    </div>

                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<footer>
    <p id="foot">© 2024 OuroborosOdyssey. Все права защищены.</p>
</footer>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        function fetchPlan(id) {
            const token = localStorage.getItem('token');

            console.log('Запрос к серверу с ID:', id);
            fetch(`http://localhost:8081/api/v1/plans/getOne?id=${id}`)
                .then(response => response.json())
                .then(data => {
                if (!data || !data.plans) {
                    console.error('Не удалось получить данные или данные не содержат ожидаемых полей');
                    return;
                }
                const planContainer = document.getElementById('plan-container');
                const planHtml = createPlanHtml(data);
                planContainer.innerHTML = planHtml;
            })
                .catch(error => {
                console.error('Ошибка при получении данных плана:', error);
            });
        }

        function createPlanHtml(plan) {
            const themesHtml = plan.theme.map(theme => `
                <li>
                    <div class="card">
                    <div class="card-header">
                    ${theme.title}

                   </div>
                    <div class="card-content">
                        <p>Описание:</p>
                        ${formatDetails(theme.details)}
                        <p>Ссылки: <a href="${theme.links}" class="card-link" target="_blank">Перейти</a></p>
                        <p>Вопросы:</p>
                        <ul>
                            ${theme.questionsList.map(question => `<li>${question.titleQuestions}</li>`).join('')}
                        </ul>
                    </div>
                    </div>
                </li>
            `).join('');

            return `
                <div class="card">
                    <div class="card-header">План изучения для разработчика: <span>${plan.developer}</span></div>
                    <div class="card-content">
                        <p>Темы:</p>
                        <ul>${themesHtml}</ul>
                    </div>
                </div>
            `;
        }
        window.editTheme = function(id, title, description, links) {
            document.getElementById('updateForm').style.display = 'block';
            document.getElementById('updateId').value = id;
            document.getElementById('updateTitle').value = title;
            document.getElementById('updateAnswer').value = description;
            document.getElementById('updateLinks').value = links;
        };

        window.updateTheme = function() {
            const id = document.getElementById('updateId').value;
            const title = document.getElementById('updateTitle').value;
            const description = document.getElementById('updateAnswer').value;
            const links = document.getElementById('updateLinks').value;

            fetch(`http://localhost:8081/api/v1/themes/update`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    id: id,
                    title: title,
                    details: description,
                    links: links
                })
            })
                .then(response => response.json())
                .then(data => {
                document.getElementById('updateMessage').innerText = 'Обновление прошло успешно!';
                fetchPlan(2);  // обновить список планов
            })
                .catch(error => {
                console.error('Ошибка при обновлении темы:', error);
                document.getElementById('updateMessage').innerText = 'Ошибка при обновлении.';
            });
        };

        window.deleteTheme = function(id) {
            const confirmDelete = confirm('Вы действительно хотите удалить эту тему?');
            if (!confirmDelete)
            return;

            fetch(`http://localhost:8081/api/v1/themes/delete/${id}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                fetchPlan(2);  // обновить список планов
            })
                .catch(error => {
                console.error('Ошибка при удалении темы:', error);
            });
        };
    });

        function formatDetails(details) {
            const paragraphs = details.split(/(?<=\.|\?|\!|\:)\s/);
            const formattedParagraphs = paragraphs.map(paragraph => `<p>${paragraph.trim()}</p>`).join('');

            if (details.length > 10) {
                return `
            <div class="collapsible-content">
                <div class="summary">${formattedParagraphs.slice(0, 200)}</div>
                <div class="full-text hidden">${formattedParagraphs}</div>
                <button onclick="this.previousElementSibling.classList.toggle('hidden');
                        this.textContent = this.previousElementSibling.classList.contains('hidden') ?
                        'Показать больше' : 'Показать меньше';">Показать больше</button>
            </div>
        `;
            }
            return formattedParagraphs;
        }

        fetchPlan(2);
    });
</script>


</body>
</html>